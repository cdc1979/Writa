(function(n,t){function v(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])}function f(n,t){for(var i in t)t.hasOwnProperty(i)&&(n.style[i]=t[i])}function r(t,i){var r=t,u=null;return n.getComputedStyle?u=document.defaultView.getComputedStyle(r,null).getPropertyValue(i):r.currentStyle&&(u=r.currentStyle[i]),u}function u(n,t,i){var e={},u;if(t==="save"){for(u in i)i.hasOwnProperty(u)&&(e[u]=r(n,u));f(n,i)}else t==="apply"&&f(n,i);return e}function y(n){var t=parseInt(r(n,"border-left-width"),10)+parseInt(r(n,"border-right-width"),10),i=parseInt(r(n,"padding-left"),10)+parseInt(r(n,"padding-right"),10),u=n.offsetWidth;return isNaN(t)&&(t=0),t+i+u}function l(n){var t=parseInt(r(n,"border-top-width"),10)+parseInt(r(n,"border-bottom-width"),10),i=parseInt(r(n,"padding-top"),10)+parseInt(r(n,"padding-bottom"),10),u=parseInt(r(n,"height"),10);return isNaN(t)&&(t=0),t+i+u}function o(n,t,i){i=i||"";var u=t.getElementsByTagName("head")[0],r=t.createElement("link");v(r,{type:"text/css",id:i,rel:"stylesheet",href:n,name:n,media:"screen"}),u.appendChild(r)}function a(n,t,i){n.className=n.className.replace(t,i)}function s(n){return n.contentDocument||n.contentWindow.document}function p(n){var t;return typeof document.body.innerText=="string"?t=n.innerText:(t=n.innerHTML.replace(/<br>/gi,"\n"),t=t.replace(/<(?:.|\n)*?>/gm,""),t=t.replace(/&lt;/gi,"<"),t=t.replace(/&gt;/gi,">")),t}function h(n,t){return t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/\n/g,"<br>"),t=t.replace(/<br>\s/g,"<br>&nbsp;"),t=t.replace(/\s\s\s/g,"&nbsp; &nbsp;"),t=t.replace(/\s\s/g,"&nbsp; "),t=t.replace(/^ /,"&nbsp;"),n.innerHTML=t,!0}function e(n){return n.replace(/\u00a0/g," ").replace(/&nbsp;/g," ")}function w(){var n=-1,i=navigator.userAgent,t;return navigator.appName=="Microsoft Internet Explorer"&&(t=/MSIE ([0-9]{1,}[\.0-9]{0,})/,t.exec(i)!=null&&(n=parseFloat(RegExp.$1,10))),n}function b(){var t=n.navigator;return t.userAgent.indexOf("Safari")>-1&&t.userAgent.indexOf("Chrome")==-1}function k(){var t=n.navigator;return t.userAgent.indexOf("Firefox")>-1&&t.userAgent.indexOf("Seamonkey")==-1}function d(n){return n&&{}.toString.call(n)==="[object Function]"}function c(){var n=arguments[0]||{},r=1,o=arguments.length,e=!1,f,u,s,i;for(typeof n=="boolean"&&(e=n,n=arguments[1]||{},r=2),typeof n=="object"||d(n)||(n={}),o===r&&(n=this,--r);r<o;r++)if((f=arguments[r])!=null)for(u in f)if(f.hasOwnProperty(u)){if(s=n[u],i=f[u],n===i)continue;e&&i&&typeof i=="object"&&!i.nodeType?n[u]=c(e,s||(i.length!=null?[]:{}),i):i!==t&&(n[u]=i)}return n}function i(n){var r=this,s=n||{},e,h={container:"epiceditor",basePath:"epiceditor",textarea:t,clientSideStorage:!0,localStorageName:"epiceditor",useNativeFullscreen:!0,file:{name:null,defaultContent:"",autoSave:100},theme:{base:"/themes/base/epiceditor.css",preview:"/themes/preview/github.css",editor:"/themes/editor/epic-dark.css"},focusOnLoad:!1,shortcut:{modifier:18,fullscreen:70,preview:80},string:{togglePreview:"Toggle Preview Mode",toggleEdit:"Toggle Edit Mode",toggleFullscreen:"Enter Fullscreen"},parser:typeof marked=="function"?marked:null,autogrow:!1,button:{fullscreen:!0,preview:!0,bar:"auto"}},f,o={minHeight:80,maxHeight:!1,scroll:!0},u;return r.settings=c(!0,h,s),u=r.settings.button,r._fullscreenEnabled=typeof u=="object"?typeof u.fullscreen=="undefined"||u.fullscreen:u===!0,r._editEnabled=typeof u=="object"?typeof u.edit=="undefined"||u.edit:u===!0,r._previewEnabled=typeof u=="object"?typeof u.preview=="undefined"||u.preview:u===!0,typeof r.settings.parser=="function"&&typeof r.settings.parser("TEST")=="string"||(r.settings.parser=function(n){return n}),r.settings.autogrow&&(r.settings.autogrow=r.settings.autogrow===!0?o:c(!0,o,r.settings.autogrow),r._oldHeight=-1),r.settings.theme.preview.match(/^https?:\/\//)||(r.settings.theme.preview=r.settings.basePath+r.settings.theme.preview),r.settings.theme.editor.match(/^https?:\/\//)||(r.settings.theme.editor=r.settings.basePath+r.settings.theme.editor),r.settings.theme.base.match(/^https?:\/\//)||(r.settings.theme.base=r.settings.basePath+r.settings.theme.base),typeof r.settings.container=="string"?r.element=document.getElementById(r.settings.container):typeof r.settings.container=="object"&&(r.element=r.settings.container),r.settings.file.name||(typeof r.settings.container=="string"?r.settings.file.name=r.settings.container:typeof r.settings.container=="object"&&(r.element.id?r.settings.file.name=r.element.id:(i._data.unnamedEditors||(i._data.unnamedEditors=[]),i._data.unnamedEditors.push(r),r.settings.file.name="__epiceditor-untitled-"+i._data.unnamedEditors.length))),r.settings.button.bar==="show"&&(r.settings.button.bar=!0),r.settings.button.bar==="hide"&&(r.settings.button.bar=!1),r._instanceId="epiceditor-"+Math.round(Math.random()*1e5),r._storage={},r._canSave=!0,r._defaultFileSchema=function(){return{content:r.settings.file.defaultContent,created:new Date,modified:new Date}},localStorage&&r.settings.clientSideStorage&&(this._storage=localStorage,this._storage[r.settings.localStorageName]&&r.getFiles(r.settings.file.name)===t&&(e=r._defaultFileSchema(),e.content=r.settings.file.defaultContent)),this._storage[r.settings.localStorageName]||(f={},f[r.settings.file.name]=r._defaultFileSchema(),f=JSON.stringify(f),this._storage[r.settings.localStorageName]=f),r._previewDraftLocation="__draft-",r._storage[r._previewDraftLocation+r.settings.localStorageName]=r._storage[r.settings.localStorageName],r._eeState={fullscreen:!1,preview:!1,edit:!1,loaded:!1,unloaded:!1},r.events||(r.events={}),this}i.prototype.load=function(t){function ht(t){i.settings.button.bar==="auto"&&((Math.abs(ot.y-t.pageY)>=5||Math.abs(ot.x-t.pageX)>=5)&&(k.style.display="block",d&&clearTimeout(d),d=n.setTimeout(function(){k.style.display="none"},1e3)),ot={y:t.pageY,x:t.pageX})}function ct(n){n.keyCode==i.settings.shortcut.modifier&&(p=!0),n.keyCode==17&&(rt=!0),p!==!0||n.keyCode!=i.settings.shortcut.preview||i.is("fullscreen")||(n.preventDefault(),i.is("edit")&&i._previewEnabled?i.preview():i._editEnabled&&i.edit()),p===!0&&n.keyCode==i.settings.shortcut.fullscreen&&i._fullscreenEnabled&&(n.preventDefault(),i._goFullscreen(c)),p===!0&&n.keyCode!==i.settings.shortcut.modifier&&(p=!1),n.keyCode==27&&i.is("fullscreen")&&i._exitFullscreen(c),rt===!0&&n.keyCode==83&&(i.save(),n.preventDefault(),rt=!1),n.metaKey&&n.keyCode==83&&(i.save(),n.preventDefault())}function lt(n){n.keyCode==i.settings.shortcut.modifier&&(p=!1),n.keyCode==17&&(rt=!1)}function at(t){var r;t.clipboardData?(t.preventDefault(),r=t.clipboardData.getData("text/plain"),i.editorIframeDocument.execCommand("insertText",!1,r)):n.clipboardData&&(t.preventDefault(),r=n.clipboardData.getData("Text"),r=r.replace(/</g,"&lt;"),r=r.replace(/>/g,"&gt;"),r=r.replace(/\n/g,"<br>"),r=r.replace(/\r/g,""),r=r.replace(/<br>\s/g,"<br>&nbsp;"),r=r.replace(/\s\s\s/g,"&nbsp; &nbsp;"),r=r.replace(/\s\s/g,"&nbsp; "),i.editorIframeDocument.selection.createRange().pasteHTML(r))}if(this.is("loaded"))return this;var i=this,tt,ut,ft,it,k,d,et,ot={y:-1,x:-1},e,st,v=!1,y=!1,g=!1,nt=!1,c,p=!1,rt=!1,l,h,a;for(i._eeState.startup=!0,i.settings.useNativeFullscreen&&(y=document.body.webkitRequestFullScreen?!0:!1,g=document.body.mozRequestFullScreen?!0:!1,nt=document.body.requestFullscreen?!0:!1,v=y||g||nt),b()&&(v=!1,y=!1),i.is("edit")||i.is("preview")||(i._eeState.edit=!0),t=t||function(){},tt={chrome:'<div id="epiceditor-wrapper" class="epiceditor-edit-mode"><iframe frameborder="0" id="epiceditor-editor-frame"><\/iframe><iframe frameborder="0" id="epiceditor-previewer-frame"><\/iframe><div id="epiceditor-utilbar">'+(i._previewEnabled?'<button title="'+this.settings.string.togglePreview+'" class="epiceditor-toggle-btn epiceditor-toggle-preview-btn"><\/button> ':"")+(i._editEnabled?'<button title="'+this.settings.string.toggleEdit+'" class="epiceditor-toggle-btn epiceditor-toggle-edit-btn"><\/button> ':"")+(i._fullscreenEnabled?'<button title="'+this.settings.string.toggleFullscreen+'" class="epiceditor-fullscreen-btn"><\/button>':"")+"<\/div><\/div>",previewer:'<div id="epiceditor-preview"><\/div>',editor:"<!doctype HTML>"},i.element.innerHTML='<iframe scrolling="no" frameborder="0" id= "'+i._instanceId+'"><\/iframe>',i.element.style.height=i.element.offsetHeight+"px",ut=document.getElementById(i._instanceId),i.iframeElement=ut,i.iframe=s(ut),i.iframe.open(),i.iframe.write(tt.chrome),i.editorIframe=i.iframe.getElementById("epiceditor-editor-frame"),i.previewerIframe=i.iframe.getElementById("epiceditor-previewer-frame"),i.editorIframeDocument=s(i.editorIframe),i.editorIframeDocument.open(),i.editorIframeDocument.write(tt.editor),i.editorIframeDocument.close(),i.previewerIframeDocument=s(i.previewerIframe),i.previewerIframeDocument.open(),i.previewerIframeDocument.write(tt.previewer),ft=i.previewerIframeDocument.createElement("base"),ft.target="_blank",i.previewerIframeDocument.getElementsByTagName("head")[0].appendChild(ft),i.previewerIframeDocument.close(),i.reflow(),o(i.settings.theme.base,i.iframe,"theme"),o(i.settings.theme.editor,i.editorIframeDocument,"theme"),o(i.settings.theme.preview,i.previewerIframeDocument,"theme"),i.iframe.getElementById("epiceditor-wrapper").style.position="relative",i.editorIframe.style.position="absolute",i.previewerIframe.style.position="absolute",i.editor=i.editorIframeDocument.body,i.previewer=i.previewerIframeDocument.getElementById("epiceditor-preview"),i.editor.contentEditable=!0,i.iframe.body.style.height=this.element.offsetHeight+"px",i.previewerIframe.style.left="-999999px",this.editorIframeDocument.body.style.wordWrap="break-word",w()>-1&&(this.previewer.style.height=parseInt(r(this.previewer,"height"),10)+2),this.open(i.settings.file.name),i.settings.focusOnLoad&&i.iframe.addEventListener("readystatechange",function(){i.iframe.readyState=="complete"&&i.focus()}),i.previewerIframeDocument.addEventListener("click",function(t){var r=t.target,u=i.previewerIframeDocument.body;r.nodeName=="A"&&r.hash&&r.hostname==n.location.hostname&&(t.preventDefault(),r.target="_self",u.querySelector(r.hash)&&(u.scrollTop=u.querySelector(r.hash).offsetTop))}),it=i.iframe.getElementById("epiceditor-utilbar"),e={},i._goFullscreen=function(t){if(this._fixScrollbars("auto"),i.is("fullscreen")){i._exitFullscreen(t);return}v&&(y?t.webkitRequestFullScreen():g?t.mozRequestFullScreen():nt&&t.requestFullscreen()),st=i.is("edit"),i._eeState.fullscreen=!0,i._eeState.edit=!0,i._eeState.preview=!0;var h=n.innerWidth,s=n.innerHeight,f=n.outerWidth,o=n.outerHeight;v||(o=n.innerHeight),e.editorIframe=u(i.editorIframe,"save",{width:f/2+"px",height:o+"px",float:"left",cssFloat:"left",styleFloat:"left",display:"block",position:"static",left:""}),e.previewerIframe=u(i.previewerIframe,"save",{width:f/2+"px",height:o+"px",float:"right",cssFloat:"right",styleFloat:"right",display:"block",position:"static",left:""}),e.element=u(i.element,"save",{position:"fixed",top:"0",left:"0",width:"100%","z-index":"9999",zIndex:"9999",border:"none",margin:"0",background:r(i.editor,"background-color"),height:s+"px"}),e.iframeElement=u(i.iframeElement,"save",{width:f+"px",height:s+"px"}),it.style.visibility="hidden",v||(document.body.style.overflow="hidden"),i.preview(),i.focus(),i.emit("fullscreenenter")},i._exitFullscreen=function(){this._fixScrollbars(),u(i.element,"apply",e.element),u(i.iframeElement,"apply",e.iframeElement),u(i.editorIframe,"apply",e.editorIframe),u(i.previewerIframe,"apply",e.previewerIframe),i.element.style.width=i._eeState.reflowWidth?i._eeState.reflowWidth:"",i.element.style.height=i._eeState.reflowHeight?i._eeState.reflowHeight:"",it.style.visibility="visible",i._eeState.fullscreen=!1,v?y?document.webkitCancelFullScreen():g?document.mozCancelFullScreen():nt&&document.exitFullscreen():document.body.style.overflow="auto",st?i.edit():i.preview(),i.reflow(),i.emit("fullscreenexit")},i.editor.addEventListener("keyup",function(){et&&n.clearTimeout(et),et=n.setTimeout(function(){i.is("fullscreen")&&i.preview()},250)}),c=i.iframeElement,it.addEventListener("click",function(n){var t=n.target.className;t.indexOf("epiceditor-toggle-preview-btn")>-1?i.preview():t.indexOf("epiceditor-toggle-edit-btn")>-1?i.edit():t.indexOf("epiceditor-fullscreen-btn")>-1&&i._goFullscreen(c)}),y?document.addEventListener("webkitfullscreenchange",function(){!document.webkitIsFullScreen&&i._eeState.fullscreen&&i._exitFullscreen(c)},!1):g?document.addEventListener("mozfullscreenchange",function(){!document.mozFullScreen&&i._eeState.fullscreen&&i._exitFullscreen(c)},!1):nt&&document.addEventListener("fullscreenchange",function(){document.fullscreenElement==null&&i._eeState.fullscreen&&i._exitFullscreen(c)},!1),k=i.iframe.getElementById("epiceditor-utilbar"),i.settings.button.bar!==!0&&(k.style.display="none"),k.addEventListener("mouseover",function(){d&&clearTimeout(d)}),l=[i.previewerIframeDocument,i.editorIframeDocument],h=0;h<l.length;h++)l[h].addEventListener("mousemove",function(n){ht(n)}),l[h].addEventListener("scroll",function(n){ht(n)}),l[h].addEventListener("keyup",function(n){lt(n)}),l[h].addEventListener("keydown",function(n){ct(n)}),l[h].addEventListener("paste",function(n){at(n)});if(i.settings.file.autoSave&&(i._saveIntervalTimer=n.setInterval(function(){i._canSave&&i.save(!1,!0)},i.settings.file.autoSave)),i.settings.textarea&&i._setupTextareaSync(),n.addEventListener("resize",function(){i.is("fullscreen")?(f(i.iframeElement,{width:n.outerWidth+"px",height:n.innerHeight+"px"}),f(i.element,{height:n.innerHeight+"px"}),f(i.previewerIframe,{width:n.outerWidth/2+"px",height:n.innerHeight+"px"}),f(i.editorIframe,{width:n.outerWidth/2+"px",height:n.innerHeight+"px"})):i.is("fullscreen")||i.reflow()}),i._eeState.loaded=!0,i._eeState.unloaded=!1,i.is("preview")?i.preview():i.edit(),i.iframe.close(),i._eeState.startup=!1,i.settings.autogrow){i._fixScrollbars(),a=function(){setTimeout(function(){i._autogrow()},1)},["keydown","keyup","paste","cut"].forEach(function(n){i.getElement("editor").addEventListener(n,a)});i.on("__update",a);i.on("edit",function(){setTimeout(a,50)});i.on("preview",function(){setTimeout(a,50)});setTimeout(a,50),a()}return t.call(this),this.emit("load"),this},i.prototype._setupTextareaSync=function(){var t=this,r=t.settings.file.name,i;t._textareaSaveTimer=n.setInterval(function(){t._canSave&&t.save(!0)},100),i=function(){t._textareaElement.value=t.exportFile(r,"text",!0)||t.settings.file.defaultContent},typeof t.settings.textarea=="string"?t._textareaElement=document.getElementById(t.settings.textarea):typeof t.settings.textarea=="object"&&(t._textareaElement=t.settings.textarea),t._textareaElement.value!==""&&(t.importFile(r,t._textareaElement.value),t.save(!0)),i();t.on("__update",i)},i.prototype._focusExceptOnLoad=function(){var n=this;(n._eeState.startup&&n.settings.focusOnLoad||!n._eeState.startup)&&n.focus()},i.prototype.unload=function(t){if(this.is("unloaded"))throw new Error("Editor isn't loaded");var i=this,r=n.parent.document.getElementById(i._instanceId);return r.parentNode.removeChild(r),i._eeState.loaded=!1,i._eeState.unloaded=!0,t=t||function(){},i.settings.textarea&&(i._textareaElement.value="",i.removeListener("__update")),i._saveIntervalTimer&&n.clearInterval(i._saveIntervalTimer),i._textareaSaveTimer&&n.clearInterval(i._textareaSaveTimer),t.call(this),i.emit("unload"),i},i.prototype.reflow=function(n,t){var i=this,s=y(i.element)-i.element.offsetWidth,h=l(i.element)-i.element.offsetHeight,o=[i.iframeElement,i.editorIframe,i.previewerIframe],u={},f,e,r;for(typeof n=="function"&&(t=n,n=null),t||(t=function(){}),r=0;r<o.length;r++)n&&n!="width"||(f=i.element.offsetWidth-s+"px",o[r].style.width=f,i._eeState.reflowWidth=f,u.width=f),n&&n!="height"||(e=i.element.offsetHeight-h+"px",o[r].style.height=e,i._eeState.reflowHeight=e,u.height=e);return i.emit("reflow",u),t.call(this,u),i},i.prototype.preview=function(){var n=this,t=n.settings.theme.preview;return a(n.getElement("wrapper"),"epiceditor-edit-mode","epiceditor-preview-mode"),n.previewerIframeDocument.getElementById("theme")?n.previewerIframeDocument.getElementById("theme").name!==t&&(n.previewerIframeDocument.getElementById("theme").href=t):o(t,n.previewerIframeDocument,"theme"),n.save(!0),n.previewer.innerHTML=n.exportFile(null,"html",!0),n.is("fullscreen")||(n.editorIframe.style.left="-999999px",n.previewerIframe.style.left="",n._eeState.preview=!0,n._eeState.edit=!1,n._focusExceptOnLoad()),n.emit("preview"),n},i.prototype.focus=function(){var n=this,t=n.is("preview"),i=t?n.previewerIframeDocument.body:n.editorIframeDocument.body;return k()&&t&&(i=n.previewerIframe),i.focus(),this},i.prototype.enterFullscreen=function(){return this.is("fullscreen")?this:(this._goFullscreen(this.iframeElement),this)},i.prototype.exitFullscreen=function(){return this.is("fullscreen")?(this._exitFullscreen(this.iframeElement),this):this},i.prototype.edit=function(){var n=this;return a(n.getElement("wrapper"),"epiceditor-preview-mode","epiceditor-edit-mode"),n._eeState.preview=!1,n._eeState.edit=!0,n.editorIframe.style.left="",n.previewerIframe.style.left="-999999px",n._focusExceptOnLoad(),n.emit("edit"),this},i.prototype.getElement=function(n){var t={container:this.element,wrapper:this.iframe.getElementById("epiceditor-wrapper"),wrapperIframe:this.iframeElement,editor:this.editorIframeDocument,editorIframe:this.editorIframe,previewer:this.previewerIframeDocument,previewerIframe:this.previewerIframe};return!t[n]||this.is("unloaded")?null:t[n]},i.prototype.is=function(n){var t=this;switch(n){case"loaded":return t._eeState.loaded;case"unloaded":return t._eeState.unloaded;case"preview":return t._eeState.preview;case"edit":return t._eeState.edit;case"fullscreen":return t._eeState.fullscreen;default:return!1}},i.prototype.open=function(n){var i=this,u=i.settings.file.defaultContent,r;return n=n||i.settings.file.name,i.settings.file.name=n,this._storage[i.settings.localStorageName]&&(r=i.exportFile(n),r!==t?(h(i.editor,r),i.emit("read")):(h(i.editor,u),i.save(),i.emit("create")),i.previewer.innerHTML=i.exportFile(null,"html"),i.emit("open")),this},i.prototype.save=function(n,i){var r=this,u,o=!1,f=r.settings.file.name,e="",h=this._storage[e+r.settings.localStorageName],s=p(this.editor);if(n&&(e=r._previewDraftLocation),this._canSave=!0,h){if(u=JSON.parse(this._storage[e+r.settings.localStorageName]),u[f]===t)u[f]=r._defaultFileSchema();else if(s!==u[f].content)u[f].modified=new Date,o=!0;else if(i)return;u[f].content=s,this._storage[e+r.settings.localStorageName]=JSON.stringify(u),o&&(r.emit("update"),r.emit("__update")),i?this.emit("autosave"):n||this.emit("save")}return this},i.prototype.remove=function(n){var t=this,i;return n=n||t.settings.file.name,n==t.settings.file.name&&(t._canSave=!1),i=JSON.parse(this._storage[t.settings.localStorageName]),delete i[n],this._storage[t.settings.localStorageName]=JSON.stringify(i),this.emit("remove"),this},i.prototype.rename=function(n,t){var r=this,i=JSON.parse(this._storage[r.settings.localStorageName]);return i[t]=i[n],delete i[n],this._storage[r.settings.localStorageName]=JSON.stringify(i),r.open(t),this},i.prototype.importFile=function(n,i,r,u){var f=this,e=!1;return n=n||f.settings.file.name,i=i||"",r=r||"md",u=u||{},JSON.parse(this._storage[f.settings.localStorageName])[n]===t&&(e=!0),f.settings.file.name=n,h(f.editor,i),e&&f.emit("create"),f.save(),f.is("fullscreen")&&f.preview(),f.settings.autogrow&&setTimeout(function(){f._autogrow()},50),this},i.prototype._getFileStore=function(n,t){var r="",i;return t&&(r=this._previewDraftLocation),i=JSON.parse(this._storage[r+this.settings.localStorageName]),n?i[n]:i},i.prototype.exportFile=function(n,i,r){var o=this,f,u;if(n=n||o.settings.file.name,i=i||"text",f=o._getFileStore(n,r),f!==t){u=f.content;switch(i){case"html":return u=e(u),o.settings.parser(u);case"text":return e(u);case"json":return f.content=e(f.content),JSON.stringify(f);case"raw":return u;default:return u}}},i.prototype.getFiles=function(n,i){var u,r=this._getFileStore(n);if(n)return r!==t&&(i?delete r.content:r.content=e(r.content)),r;for(u in r)r.hasOwnProperty(u)&&(i?delete r[u].content:r[u].content=e(r[u].content));return r},i.prototype.on=function(n,t){var i=this;return this.events[n]||(this.events[n]=[]),this.events[n].push(t),i},i.prototype.emit=function(n,t){function u(n){n.call(i,t)}var i=this,r;if(t=t||i.getFiles(i.settings.file.name),this.events[n]){for(r=0;r<i.events[n].length;r++)u(i.events[n][r]);return i}},i.prototype.removeListener=function(n,t){var i=this;return t?this.events[n]?(this.events[n].splice(this.events[n].indexOf(t),1),i):i:(this.events[n]=[],i)},i.prototype._autogrow=function(){var u,t,i,r,f,e=!1;this.is("fullscreen")||(f=this.is("edit")?this.getElement("editor").documentElement:this.getElement("previewer").documentElement,u=l(f),t=u,i=this.settings.autogrow.minHeight,typeof i=="function"&&(i=i(this)),i&&t<i&&(t=i),r=this.settings.autogrow.maxHeight,typeof r=="function"&&(r=r(this)),r&&t>r&&(t=r,e=!0),e?this._fixScrollbars("auto"):this._fixScrollbars("hidden"),t!=this.oldHeight&&(this.getElement("container").style.height=t+"px",this.reflow(),this.settings.autogrow.scroll&&n.scrollBy(0,t-this.oldHeight),this.oldHeight=t))},i.prototype._fixScrollbars=function(n){var t;t=this.settings.autogrow?"hidden":"auto",t=n||t,this.getElement("editor").documentElement.style.overflow=t,this.getElement("previewer").documentElement.style.overflow=t},i.version="0.2.2",i._data={},n.EpicEditor=i})(window),function(){function o(t){this.tokens=[],this.tokens.links={},this.options=t||i.defaults,this.rules=n.normal,this.options.gfm&&(this.rules=this.options.tables?n.tables:n.gfm)}function e(n,r){if(this.options=r||i.defaults,this.links=n,this.rules=t.normal,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.rules=this.options.breaks?t.breaks:t.gfm:this.options.pedantic&&(this.rules=t.pedantic)}function f(n){this.tokens=[],this.token=null,this.options=n||i.defaults}function r(n,t){return n.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function u(n,t){return n=n.source,t=t||"",function i(r,u){return r?(u=u.source||u,u=u.replace(/(^|[^\[])\^/g,"$1"),n=n.replace(r,u),i):new RegExp(n,t)}}function s(){}function h(n){for(var r=1,t,i;r<arguments.length;r++){t=arguments[r];for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n}function i(n,t){try{return f.parse(o.lex(n,t),t)}catch(r){if(r.message+="\nPlease report this to https://github.com/chjj/marked.",(t||i.defaults).silent)return"An error occured:\n"+r.message;throw r;}}var n={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:s,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:s,lheading:/^([^\n]+)\n *(=|-){3,} *\n*/,blockquote:/^( *>[^\n]+(\n[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *([^\s]+)(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:s,paragraph:/^([^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+\n*/,text:/^[^\n]+/},t;n.bullet=/(?:[*+-]|\d+\.)/,n.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,n.item=u(n.item,"gm")(/bull/g,n.bullet)(),n.list=u(n.list)(/bull/g,n.bullet)("hr",/\n+(?=(?: *[-*_]){3,} *(?:\n+|$))/)(),n._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|@)\\b",n.html=u(n.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,n._tag)(),n.paragraph=u(n.paragraph)("hr",n.hr)("heading",n.heading)("lheading",n.lheading)("blockquote",n.blockquote)("tag","<"+n._tag)("def",n.def)(),n.normal=h({},n),n.gfm=h({},n.normal,{fences:/^ *(`{3,}|~{3,}) *(\w+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/}),n.gfm.paragraph=u(n.paragraph)("(?!","(?!"+n.gfm.fences.source.replace("\\1","\\2")+"|")(),n.tables=h({},n.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),o.rules=n,o.lex=function(n,t){var i=new o(t);return i.lex(n)},o.prototype.lex=function(n){return n=n.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(n,!0)},o.prototype.token=function(n,t){for(var n=n.replace(/^ +$/gm,""),f,e,i,r,o,u,s;n;){if((i=this.rules.newline.exec(n))&&(n=n.substring(i[0].length),i[0].length>1&&this.tokens.push({type:"space"})),i=this.rules.code.exec(n)){n=n.substring(i[0].length),i=i[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?i:i.replace(/\n+$/,"")});continue}if(i=this.rules.fences.exec(n)){n=n.substring(i[0].length),this.tokens.push({type:"code",lang:i[2],text:i[3]});continue}if(i=this.rules.heading.exec(n)){n=n.substring(i[0].length),this.tokens.push({type:"heading",depth:i[1].length,text:i[2]});continue}if(t&&(i=this.rules.nptable.exec(n))){for(n=n.substring(i[0].length),r={type:"table",header:i[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:i[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:i[3].replace(/\n$/,"").split("\n")},u=0;u<r.align.length;u++)r.align[u]=/^ *-+: *$/.test(r.align[u])?"right":/^ *:-+: *$/.test(r.align[u])?"center":/^ *:-+ *$/.test(r.align[u])?"left":null;for(u=0;u<r.cells.length;u++)r.cells[u]=r.cells[u].split(/ *\| */);this.tokens.push(r);continue}if(i=this.rules.lheading.exec(n)){n=n.substring(i[0].length),this.tokens.push({type:"heading",depth:i[2]==="="?1:2,text:i[1]});continue}if(i=this.rules.hr.exec(n)){n=n.substring(i[0].length),this.tokens.push({type:"hr"});continue}if(i=this.rules.blockquote.exec(n)){n=n.substring(i[0].length),this.tokens.push({type:"blockquote_start"}),i=i[0].replace(/^ *> ?/gm,""),this.token(i,t),this.tokens.push({type:"blockquote_end"});continue}if(i=this.rules.list.exec(n)){for(n=n.substring(i[0].length),this.tokens.push({type:"list_start",ordered:isFinite(i[2])}),i=i[0].match(this.rules.item),f=!1,s=i.length,u=0;u<s;u++)r=i[u],o=r.length,r=r.replace(/^ *([*+-]|\d+\.) +/,""),~r.indexOf("\n ")&&(o-=r.length,r=this.options.pedantic?r.replace(/^ {1,4}/gm,""):r.replace(new RegExp("^ {1,"+o+"}","gm"),"")),e=f||/\n\n(?!\s*$)/.test(r),u!==s-1&&(f=r[r.length-1]==="\n",e||(e=f)),this.tokens.push({type:e?"loose_item_start":"list_item_start"}),this.token(r,!1),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"});continue}if(i=this.rules.html.exec(n)){n=n.substring(i[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:i[1]==="pre",text:i[0]});continue}if(t&&(i=this.rules.def.exec(n))){n=n.substring(i[0].length),this.tokens.links[i[1].toLowerCase()]={href:i[2],title:i[3]};continue}if(t&&(i=this.rules.table.exec(n))){for(n=n.substring(i[0].length),r={type:"table",header:i[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:i[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:i[3].replace(/(?: *\| *)?\n$/,"").split("\n")},u=0;u<r.align.length;u++)r.align[u]=/^ *-+: *$/.test(r.align[u])?"right":/^ *:-+: *$/.test(r.align[u])?"center":/^ *:-+ *$/.test(r.align[u])?"left":null;for(u=0;u<r.cells.length;u++)r.cells[u]=r.cells[u].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(r);continue}if(t&&(i=this.rules.paragraph.exec(n))){n=n.substring(i[0].length),this.tokens.push({type:"paragraph",text:i[0]});continue}if(i=this.rules.text.exec(n)){n=n.substring(i[0].length),this.tokens.push({type:"text",text:i[0]});continue}if(n)throw new Error("Infinite loop on byte: "+n.charCodeAt(0));}return this.tokens},t={escape:/^\\([\\`*{}\[\]()#+\-.!_>|])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:s,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)([\s\S]*?[^`])\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:s,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/},t._inside=/(?:\[[^\]]*\]|[^\]]|\](?=[^\[]*\]))*/,t._href=/\s*<?([^\s]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,t.link=u(t.link)("inside",t._inside)("href",t._href)(),t.reflink=u(t.reflink)("inside",t._inside)(),t.normal=h({},t),t.pedantic=h({},t.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),t.gfm=h({},t.normal,{escape:u(t.escape)("])","~])")(),url:/^(https?:\/\/[^\s]+[^.,:;"')\]\s])/,del:/^~{2,}([\s\S]+?)~{2,}/,text:u(t.text)("]|","~]|")("|","|https?://|")()}),t.breaks=h({},t.gfm,{br:u(t.br)("{2,}","*")(),text:u(t.gfm.text)("{2,}","*")()}),e.rules=t,e.output=function(n,t,i){var r=new e(t,i);return r.output(n)},e.prototype.output=function(n){for(var i="",f,u,e,t;n;){if(t=this.rules.escape.exec(n)){n=n.substring(t[0].length),i+=t[1];continue}if(t=this.rules.autolink.exec(n)){n=n.substring(t[0].length),t[2]==="@"?(u=t[1][6]===":"?this.mangle(t[1].substring(7)):this.mangle(t[1]),e=this.mangle("mailto:")+u):(u=r(t[1]),e=u),i+='<a href="'+e+'">'+u+"<\/a>";continue}if(t=this.rules.url.exec(n)){n=n.substring(t[0].length),u=r(t[1]),e=u,i+='<a href="'+e+'">'+u+"<\/a>";continue}if(t=this.rules.tag.exec(n)){n=n.substring(t[0].length),i+=this.options.sanitize?r(t[0]):t[0];continue}if(t=this.rules.link.exec(n)){n=n.substring(t[0].length),i+=this.outputLink(t,{href:t[2],title:t[3]});continue}if((t=this.rules.reflink.exec(n))||(t=this.rules.nolink.exec(n))){if(n=n.substring(t[0].length),f=(t[2]||t[1]).replace(/\s+/g," "),f=this.links[f.toLowerCase()],!f||!f.href){i+=t[0][0],n=t[0].substring(1)+n;continue}i+=this.outputLink(t,f);continue}if(t=this.rules.strong.exec(n)){n=n.substring(t[0].length),i+="<strong>"+this.output(t[2]||t[1])+"<\/strong>";continue}if(t=this.rules.em.exec(n)){n=n.substring(t[0].length),i+="<em>"+this.output(t[2]||t[1])+"<\/em>";continue}if(t=this.rules.code.exec(n)){n=n.substring(t[0].length),i+="<code>"+r(t[2],!0)+"<\/code>";continue}if(t=this.rules.br.exec(n)){n=n.substring(t[0].length),i+="<br>";continue}if(t=this.rules.del.exec(n)){n=n.substring(t[0].length),i+="<del>"+this.output(t[1])+"<\/del>";continue}if(t=this.rules.text.exec(n)){n=n.substring(t[0].length),i+=r(t[0]);continue}if(n)throw new Error("Infinite loop on byte: "+n.charCodeAt(0));}return i},e.prototype.outputLink=function(n,t){return n[0][0]!=="!"?'<a href="'+r(t.href)+'"'+(t.title?' title="'+r(t.title)+'"':"")+">"+this.output(n[1])+"<\/a>":'<img src="'+r(t.href)+'" alt="'+r(n[1])+'"'+(t.title?' title="'+r(t.title)+'"':"")+">"},e.prototype.mangle=function(n){for(var r="",u=n.length,i=0,t;i<u;i++)t=n.charCodeAt(i),Math.random()>.5&&(t="x"+t.toString(16)),r+="&#"+t+";";return r},f.parse=function(n,t){var i=new f(t);return i.parse(n)},f.prototype.parse=function(n){this.inline=new e(n.links,this.options),this.tokens=n.reverse();for(var t="";this.next();)t+=this.tok();return t},f.prototype.next=function(){return this.token=this.tokens.pop()},f.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},f.prototype.parseText=function(){for(var n=this.token.text;this.peek().type==="text";)n+="\n"+this.next().text;return this.inline.output(n)},f.prototype.tok=function(){var u,f,t,e,o,i,s,n;switch(this.token.type){case"space":return"";case"hr":return"<hr>\n";case"heading":return"<h"+this.token.depth+">"+this.inline.output(this.token.text)+"<\/h"+this.token.depth+">\n";case"code":return this.options.highlight&&(u=this.options.highlight(this.token.text,this.token.lang),u!=null&&u!==this.token.text&&(this.token.escaped=!0,this.token.text=u)),this.token.escaped||(this.token.text=r(this.token.text,!0)),"<pre><code"+(this.token.lang?' class="lang-'+this.token.lang+'"':"")+">"+this.token.text+"<\/code><\/pre>\n";case"table":for(n="",n+="<thead>\n<tr>\n",t=0;t<this.token.header.length;t++)f=this.inline.output(this.token.header[t]),n+=this.token.align[t]?'<th align="'+this.token.align[t]+'">'+f+"<\/th>\n":"<th>"+f+"<\/th>\n";for(n+="<\/tr>\n<\/thead>\n",n+="<tbody>\n",t=0;t<this.token.cells.length;t++){for(e=this.token.cells[t],n+="<tr>\n",i=0;i<e.length;i++)o=this.inline.output(e[i]),n+=this.token.align[i]?'<td align="'+this.token.align[i]+'">'+o+"<\/td>\n":"<td>"+o+"<\/td>\n";n+="<\/tr>\n"}return n+="<\/tbody>\n","<table>\n"+n+"<\/table>\n";case"blockquote_start":for(n="";this.next().type!=="blockquote_end";)n+=this.tok();return"<blockquote>\n"+n+"<\/blockquote>\n";case"list_start":for(s=this.token.ordered?"ol":"ul",n="";this.next().type!=="list_end";)n+=this.tok();return"<"+s+">\n"+n+"<\/"+s+">\n";case"list_item_start":for(n="";this.next().type!=="list_item_end";)n+=this.token.type==="text"?this.parseText():this.tok();return"<li>"+n+"<\/li>\n";case"loose_item_start":for(n="";this.next().type!=="list_item_end";)n+=this.tok();return"<li>"+n+"<\/li>\n";case"html":return!this.token.pre&&!this.options.pedantic?this.inline.output(this.token.text):this.token.text;case"paragraph":return"<p>"+this.inline.output(this.token.text)+"<\/p>\n";case"text":return"<p>"+this.parseText()+"<\/p>\n"}},s.exec=s,i.options=i.setOptions=function(n){return i.defaults=n,i},i.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,silent:!1,highlight:null},i.Parser=f,i.parser=f.parse,i.Lexer=o,i.lexer=o.lex,i.InlineLexer=e,i.inlineLexer=e.output,i.parse=i,typeof module!="undefined"?module.exports=i:typeof define=="function"&&define.amd?define(function(){return i}):this.marked=i}.call(function(){return this||(typeof window!="undefined"?window:global)}());
//# sourceMappingURL=epiceditor.min.js.map